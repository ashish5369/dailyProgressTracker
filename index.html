<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Architect Dashboard</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyD6FfQzZdeNO2svGl1lcN5p4_eVIfvO5oM",
  authDomain: "personalprogresstracker-3ea5e.firebaseapp.com",
  projectId: "personalprogresstracker-3ea5e",
  storageBucket: "personalprogresstracker-3ea5e.firebasestorage.app",
  messagingSenderId: "408574075331",
  appId: "1:408574075331:web:69f0279ce9dab5a2619d76"
};

// Initialize Firebase

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const syllabus = [
["Variables & Types","Big O","Programs"],
["Slices & Maps","Two Sum","Practice"],
["Functions","Sliding Window","Practice"],
["Structs","Hashing","Practice"],
["Pointers","Strings","Practice"],
["Interfaces","Recursion","CLI App"],
["Revision","Revision","Revision"],
["Goroutines","Linked List","Practice"],
["Channels","Reverse LL","Practice"],
["Select","Stack","Practice"],
["Mutex","Queue","Practice"],
["Logging","Binary Search","Practice"],
["Concurrency Build","Binary Search","File Processor"],
["Revision","Revision","Revision"],
["HTTP Basics","",""],
["Gin CRUD","","API Build"],
["Postgres","","DB Setup"],
["Go + Postgres","","Integration"],
["Clean Architecture","","Refactor"],
["Auth + JWT","","Major Build"],
["Revision","",""],
["Redis","","Cache"],
["Rate Limiting","","Implementation"],
["Docker","","Containerize"],
["Docker Compose","","Full Stack Run"],
["Logging Upgrade","","Refactor"],
["Final Upgrade","","Project Polish"],
["Load Balancer","","System Design"],
["Scaling Architecture","","Design Doc"],
["Full Revision","",""]
];

let state = {
  tasks: Array.from({length:30},()=>({go:false,dsa:false,build:false})),
  dsa:0,
  arch:0,
  milestones:{m1:false,m2:false,m3:false,m4:false},
  lastActive:null,
  streak:0
};

signInAnonymously(auth);

onAuthStateChanged(auth,(user)=>{
  if(user){
    const ref=doc(db,"users","globalUser");
    onSnapshot(ref,(snap)=>{
      if(snap.exists()){
        state=snap.data();
      }else{
        setDoc(ref,state);
      }
      render();
    });
  }
});

function render(){
  const body=document.getElementById("tableBody");
  body.innerHTML="";

  state.tasks.forEach((t,i)=>{
    const complete=t.go&&t.dsa&&t.build;

    body.innerHTML+=`
      <tr>
        <td><b>Day ${i+1}</b></td>

        <td>
          ${syllabus[i][0]||""}<br>
          ${syllabus[i][0]?`<input type="checkbox" ${t.go?"checked":""} onclick="toggle(${i},'go')">`:""}
        </td>

        <td>
          ${syllabus[i][1]||""}<br>
          ${syllabus[i][1]?`<input type="checkbox" ${t.dsa?"checked":""} onclick="toggle(${i},'dsa')">`:""}
        </td>

        <td>
          ${syllabus[i][2]||""}<br>
          ${syllabus[i][2]?`<input type="checkbox" ${t.build?"checked":""} onclick="toggle(${i},'build')">`:""}
        </td>

        <td>${complete?"âœ…":"âŒ"}</td>
      </tr>
    `;
  });

  updateProgress();
  document.getElementById("dsaTotal").innerText=state.dsa;
  document.getElementById("archSkill").value=state.arch;
  document.getElementById("archValue").innerText=state.arch;
  document.getElementById("streak").innerText=state.streak;
}

window.toggle=function(i,type){
  state.tasks[i][type]=!state.tasks[i][type];
  updateStreak();
  save();
}

function updateStreak(){
  const today=new Date().toDateString();
  if(state.lastActive!==today){
    state.streak++;
    state.lastActive=today;
  }
}

function updateProgress(){
  const done=state.tasks.filter(t=>t.go&&t.dsa&&t.build).length;
  const percent=Math.round((done/30)*100);
  document.getElementById("progress").innerText=percent+"%";
}

window.addDSA=function(){
  const val=parseInt(document.getElementById("dsaInput").value)||0;
  state.dsa+=val;
  save();
}

window.save=function(){
  state.arch=document.getElementById("archSkill").value;
  state.milestones.m1=document.getElementById("m1").checked;
  state.milestones.m2=document.getElementById("m2").checked;
  state.milestones.m3=document.getElementById("m3").checked;
  state.milestones.m4=document.getElementById("m4").checked;

  setDoc(doc(db,"users","globalUser"),state);
}
</script>

<style>
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
  padding:30px;
}
h1{text-align:center;}
.card{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(15px);
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}
table{width:100%;border-collapse:collapse;}
th,td{padding:10px;text-align:center;}
th{background:rgba(255,255,255,0.1);}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
input[type=checkbox]{transform:scale(1.2);}
button{padding:6px 12px;border:none;border-radius:8px;background:#38bdf8;color:black;}
</style>
</head>

<body>

<h1>ğŸš€ Architect Dashboard</h1>

<div class="card">
ğŸ”¥ Streak: <span id="streak">0</span> |
ğŸ“Š Progress: <span id="progress">0%</span>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Day</th>
<th>Go</th>
<th>DSA</th>
<th>Build</th>
<th>Complete</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div class="card">
ğŸ§  DSA Total: <span id="dsaTotal">0</span>
<input type="number" id="dsaInput">
<button onclick="addDSA()">Add</button>
</div>

<div class="card">
ğŸ— Architecture Level:
<input type="range" min="0" max="100" id="archSkill" onchange="save()">
<span id="archValue">0</span>%
</div>

<div class="card">
ğŸ† Milestones<br>
<label><input type="checkbox" id="m1" onchange="save()"> Auth Service</label><br>
<label><input type="checkbox" id="m2" onchange="save()"> Concurrency Project</label><br>
<label><input type="checkbox" id="m3" onchange="save()"> Redis + Docker</label><br>
<label><input type="checkbox" id="m4" onchange="save()"> Final Refactor</label>
</div>

</body>
</html>