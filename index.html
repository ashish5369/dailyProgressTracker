<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Progress Tracker</title>

<style>
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
  padding:30px;
}
h1{text-align:center;}
.card{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(15px);
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}
table{width:100%;border-collapse:collapse;}
th,td{padding:10px;text-align:center;}
th{background:rgba(255,255,255,0.1);}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
input[type=checkbox]{transform:scale(1.2);}
button{padding:6px 12px;border:none;border-radius:8px;background:#38bdf8;color:black;}
</style>
</head>

<body>

<h1>ğŸš€ Daily Progress Tracker</h1>

<div class="card">
ğŸ”¥ Streak: <span id="streak">0</span> |
ğŸ“Š Progress: <span id="progress">0%</span> |
<button onclick="window.loadFromGitHub()">Load Progress</button>
<button onclick="window.save()">Save Progress</button>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Day</th>
<th>Go</th>
<th>DSA</th>
<th>Build</th>
<th>Complete</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div class="card">
ğŸ§  DSA Total: <span id="dsaTotal">0</span>
<input type="number" id="dsaInput">
<button onclick="window.addDSA()">Add</button>
</div>

<div class="card">
ğŸ— Architecture Level:
<input type="range" min="0" max="100" id="archSkill" onchange="window.save()">
<span id="archValue">0</span>%
</div>

<div class="card">
ğŸ† Milestones<br>
<label><input type="checkbox" id="m1" onchange="window.save()"> Auth Service</label><br>
<label><input type="checkbox" id="m2" onchange="window.save()"> Concurrency Project</label><br>
<label><input type="checkbox" id="m3" onchange="window.save()"> Redis + Docker</label><br>
<label><input type="checkbox" id="m4" onchange="window.save()"> Final Refactor</label>
</div>

<script type="module">
const syllabus = [
    ["Variables, Types, Setup", "Big O, Complexity", "Problem Solving"],
    ["Arrays & Slices", "Arrays Pattern", "Problem Solving"],
    ["Maps & Strings", "Hashing", "Problem Solving"],
    ["Functions & Error Handling", "Sliding Window", "Problem Solving"],
    ["Structs & Methods", "Two Pointers", "Problem Solving"],
    ["Pointers & Memory", "Recursion", "Problem Solving"],
    ["Revision", "Revision", "CLI Task Manager"],
    ["Goroutines", "Linked List Basics", "Problem Solving"],
    ["Channels & Select", "Fast & Slow Pointers", "Problem Solving"],
    ["Mutex & Sync", "Stack", "Problem Solving"],
    ["Interfaces & Queues", "Binary Search", "Problem Solving"],
    ["Error Wrapping & Logging", "Monotonic Stack", "Problem Solving"],
    ["Concurrency Project", "Pattern Review", "Concurrent File Processor"],
    ["Revision", "Revision", "Revision"],
    ["HTTP Deep Dive", "REST Principles", "Study"],
    ["Basic HTTP Server (net/http)", "Middleware", "Build In-Memory Server"],
    ["Gin Framework", "Routing, Binding", "CRUD API (in-memory)"],
    ["PostgreSQL Basics", "ACID, Indexes", "DB Setup & Study"],
    ["Go + Postgres", "Repository Pattern", "Integrate DB into API"],
    ["Authentication", "JWT, Hashing", "Build Auth System"],
    ["Clean Architecture", "SOLID", "Refactor Project"],
    ["Redis Caching", "TTL, Eviction", "Add Cache to API"],
    ["Docker & Docker Compose", "Containerization", "Dockerize Full Stack"],
    ["System Design Basics", "Scaling, CAP Theorem", "Design for 1M Users"],
    ["Message Queues", "Kafka vs RabbitMQ", "Async Architecture Design"],
    ["Rate Limiting", "Redis Implementation", "Implement Rate Limiter"],
    ["Logging & Monitoring", "Observability", "Study"],
    ["Scalable System Redesign", "Architecture Diagram", "Draw Full Architecture"],
    ["Mock System Design Interview", "Common Problems", "Design URL Shortener"],
    ["Full Revision", "Project Polish", "Final Review"]
];

let appState = {
  tasks: Array.from({length:30},()=>({go:false,dsa:false,build:false})),
  dsa:0,
  arch:0,
  milestones:{m1:false,m2:false,m3:false,m4:false},
  lastActive:null,
  streak:0
};

// GitHub configuration
const GITHUB_CONFIG = {
  owner: "aashish5369", // Change this to your GitHub username
  repo: "dailyProgressTracker", // Change this to your repo name
  file: "progress.json",
  branch: "main"
};

// Add your GitHub Personal Access Token here (personal use only)
let githubToken = "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"; // Replace with your token from https://github.com/settings/tokens

const renderFn = () => {
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  appState.tasks.forEach((t,i) => {
    const complete = t.go && t.dsa && t.build;

    body.innerHTML += `
      <tr>
        <td><b>Day ${i+1}</b></td>

        <td>
          ${syllabus[i][0]||""}<br>
          ${syllabus[i][0]?`<input type="checkbox" ${t.go?"checked":""} onclick="window.toggle(${i},'go')">`:""}
        </td>

        <td>
          ${syllabus[i][1]||""}<br>
          ${syllabus[i][1]?`<input type="checkbox" ${t.dsa?"checked":""} onclick="window.toggle(${i},'dsa')">`:""}
        </td>

        <td>
          ${syllabus[i][2]||""}<br>
          ${syllabus[i][2]?`<input type="checkbox" ${t.build?"checked":""} onclick="window.toggle(${i},'build')">`:""}
        </td>

        <td>${complete?"âœ…":"âŒ"}</td>
      </tr>
    `;
  });

  updateProgress();
  document.getElementById("dsaTotal").innerText = appState.dsa;
  document.getElementById("archSkill").value = appState.arch;
  document.getElementById("archValue").innerText = appState.arch;
  document.getElementById("streak").innerText = appState.streak;
};

const updateStreak = () => {
  const today = new Date().toDateString();
  if(appState.lastActive !== today){
    appState.streak++;
    appState.lastActive = today;
  }
};

const updateProgress = () => {
  const done = appState.tasks.filter(t => t.go && t.dsa && t.build).length;
  const percent = Math.round((done/30)*100);
  document.getElementById("progress").innerText = percent + "%";
};

window.loadFromGitHub = async () => {
  try {
    const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.file}`;
    const response = await fetch(url, {
      headers: githubToken ? { "Authorization": `token ${githubToken}` } : {}
    });
    
    if (response.ok) {
      const data = await response.json();
      const content = JSON.parse(atob(data.content));
      appState = content;
      renderFn();
      return true;
    }
  } catch (e) {
    console.log("Could not load from GitHub:", e.message);
  }
  renderFn();
  return false;
};

window.toggle = (i, type) => {
  appState.tasks[i][type] = !appState.tasks[i][type];
  updateStreak();
  window.save();
};

window.addDSA = () => {
  const val = parseInt(document.getElementById("dsaInput").value) || 0;
  appState.dsa += val;
  document.getElementById("dsaInput").value = "";
  window.save();
};

window.save = async () => {
  appState.arch = document.getElementById("archSkill").value;
  appState.milestones.m1 = document.getElementById("m1").checked;
  appState.milestones.m2 = document.getElementById("m2").checked;
  appState.milestones.m3 = document.getElementById("m3").checked;
  appState.milestones.m4 = document.getElementById("m4").checked;

  if (!githubToken) {
    alert("Please set your GitHub token first by clicking 'Setup GitHub'");
    return;
  }

  try {
    const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.file}`;
    
    // First, get the current file to get its SHA
    let sha = null;
    try {
      const getResponse = await fetch(url, {
        headers: { "Authorization": `token ${githubToken}` }
      });
      if (getResponse.ok) {
        const fileData = await getResponse.json();
        sha = fileData.sha;
      }
    } catch (e) {
      console.log("File doesn't exist yet, will create new");
    }

    const content = btoa(JSON.stringify(appState, null, 2));
    const payload = {
      message: `Update progress - ${new Date().toLocaleString()}`,
      content: content,
      branch: GITHUB_CONFIG.branch
    };

    if (sha) {
      payload.sha = sha;
    }

    const response = await fetch(url, {
      method: "PUT",
      headers: {
        "Authorization": `token ${githubToken}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    if (response.ok) {
      console.log("Progress saved to GitHub successfully!");
    } else {
      const errorData = await response.json();
      alert(`Error saving to GitHub: ${errorData.message}`);
    }
  } catch (e) {
    alert(`Error: ${e.message}`);
  }
};

window.setupGithub = () => {
  githubToken = prompt("Paste your GitHub token here (it will be saved in the code for future use):");
  
  if (githubToken && githubToken !== "YOUR_GITHUB_TOKEN_HERE") {
    alert("Token saved! Make sure to update the githubToken variable in the HTML for this to persist.");
  }
};

window.render = renderFn;

// Load data on page load
window.addEventListener("load", () => {
  window.loadFromGitHub();
});
</script>